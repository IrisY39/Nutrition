<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è¥å…»è®¡ç®—å™¨</title>
  <style>
    * {
      box-sizing: border-box;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      font-size: 14px;
    }

    th {
      background-color: #f7f7f7;
    }
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 10px;
      background-color: #fdfcfb;
    }
    h1 {
      color: #333;
    }
    .link-button {
      margin-top: 5px;
      display: inline-block;
      padding: 6px 12px;
      background-color: #ffddaa;
      color: #333;
      text-decoration: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .hidden {
      display: none;
    }
    h2 {
      color: #333;
      margin-top: 20px;
    }
    .meal-section {
      background-color: #fff;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .food-entry {
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
    }
    label {
      font-weight: bold;
      margin-bottom: 5px;
    }
    select, input {
      padding: 8px;
      margin-bottom: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .totals {
      margin-top: 15px;
      font-weight: bold;
      color: #444;
    }
    .add-food {
      margin-top: 10px;
      padding: 6px 12px;
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 5px;
      cursor: pointer;
    }
    ul {
      margin-top: 10px;
      padding-left: 20px;
    }
    ul li {
      margin-bottom: 5px;
    }
    @media (min-width: 600px) {
      .food-entry {
        flex-direction: row;
        align-items: center;
        gap: 10px;
      }
      label {
        width: 80px;
        margin-bottom: 0;
      }
    }
    .remove-button {
      margin-left: 6px;
      padding: 2px 6px;
      background: #ffe5e5;
      border: 1px solid #cc4444;
      color: #cc0000;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div id="main-page">
    <h1>è¥å…»è®¡ç®—å™¨ğŸ±</h1>
    <button class="link-button" onclick="showManager()">ğŸ”§ ç‚¹å‡»ç®¡ç†é£Ÿç‰©æ•°æ®åº“</button>

    <div class="meal-section" id="breakfast">
      <h2>ğŸ æ—©é¤</h2>
      <div class="food-list"></div>
      <button class="add-food" onclick="addFoodEntry('breakfast')">â• æ·»åŠ é£Ÿç‰©</button>
      <div class="totals" id="breakfast-total">è¥å…»æˆåˆ†: ç­‰å¾…è¾“å…¥ä¸­...</div>
    </div>

    <div class="meal-section" id="lunch">
      <h2>ğŸ± åˆé¤</h2>
      <div class="food-list"></div>
      <button class="add-food" onclick="addFoodEntry('lunch')">â• æ·»åŠ é£Ÿç‰©</button>
      <div class="totals" id="lunch-total">è¥å…»æˆåˆ†: ç­‰å¾…è¾“å…¥ä¸­...</div>
    </div>

    <div class="meal-section" id="dinner">
      <h2>ğŸ” æ™šé¤</h2>
      <div class="food-list"></div>
      <button class="add-food" onclick="addFoodEntry('dinner')">â• æ·»åŠ é£Ÿç‰©</button>
      <div class="totals" id="dinner-total">è¥å…»æˆåˆ†: ç­‰å¾…è¾“å…¥ä¸­...</div>
    </div>

    <h2>ğŸ“Š æ¯æ—¥æ‘„å…¥è®°å½• / æ€»è®¡</h2>
    <ul id="intakeTable">
    </ul>
    <!-- æ€»è®¡æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="totals" id="daily-total">
      è›‹ç™½è´¨ï¼š-- g<br />
      è„‚è‚ªï¼š-- g<br />
      ç¢³æ°´ï¼š-- g<br />
      é•ï¼š-- mg<br />
      é’™ï¼š-- mg<br />
    </div>
      <!-- è¿™é‡Œå°†ç”± JS åŠ¨æ€æ·»åŠ è®°å½•é¡¹ -->
    <!-- é‡ç½®æŒ‰é’® -->
    <button onclick="resetDailyIntake()">é‡ç½®ä»Šæ—¥è®°å½•</button>

  </div>
  <div id="manager-page" class="hidden">
    <h1>ğŸ½ï¸ é£Ÿç‰©ç®¡ç†</h1>
    <button class="link-button" onclick="showMain()">â¬…ï¸ è¿”å›</button>

    <label for="foodName">é£Ÿç‰©åç§°ï¼š</label>
    <input type="text" id="foodName" placeholder="ä¾‹å¦‚ï¼šé¸¡è›‹">

    <label for="protein">è›‹ç™½è´¨ï¼ˆg/100gï¼‰ï¼š</label>
    <input type="number" id="protein">

    <label for="fat">è„‚è‚ªï¼ˆg/100gï¼‰ï¼š</label>
    <input type="number" id="fat">

    <label for="carbs">ç¢³æ°´ï¼ˆg/100gï¼‰ï¼š</label>
    <input type="number" id="carbs">

    <label for="magnesium">é•ï¼ˆmg/100gï¼‰ï¼š</label>
    <input type="number" id="magnesium">

    <label for="calcium">é’™ï¼ˆmg/100gï¼‰ï¼š</label>
    <input type="number" id="calcium">

    <button onclick="addFood()">â• æ·»åŠ é£Ÿç‰©</button>

    <h2>ğŸ“‹ å½“å‰é»˜è®¤é£Ÿç‰©æ•°æ®åº“ï¼š</h2>
    <ul id="foodReference"></ul>

    <h2>ğŸ“ ä½ æ·»åŠ çš„è‡ªå®šä¹‰é£Ÿç‰©ï¼š</h2>
    <ul id="foodList"></ul>
  </div>

  <script>
    let foodOptions = [];
    let foodData = {};

    function loadFoodsFromStorage() {
      foodOptions = [ "æ ¸æ¡ƒä»", "å—ç“œç±½", "ç†Ÿäºšéº»ç±½", "çº¯ç¢±çƒ¤é¦", "æ™®é€šéº¦ç‰‡", "äº”é»‘éº¦ç‰‡", "åŒ…å­ï¼ˆä¸ªï¼‰", "èŠ‹å¤´","ç”œç‰ç±³",
        "ç™½ç±³è—œéº¦é¥­ï¼ˆä»½ï¼‰", "è‹¦èéº¦é¢", "æ™®é€šé¢æ¡", "åŒå‰ï¼ˆä»½ï¼‰","å•å‰ï¼ˆä»½ï¼‰","0å‰ï¼ˆæ±‰å ¡åŒ…ï¼‰ï¼ˆä»½ï¼‰",
       "éº¦é¦™é¸¡ï¼ˆä»½ï¼‰","éº¦é¦™é±¼ï¼ˆä»½ï¼‰","çŒªæŸ³éº¦æ»¡åˆ†ï¼ˆä»½ï¼‰","çŒªæŸ³è›‹éº¦æ»¡åˆ†ï¼ˆä»½ï¼‰", "è èœ", "å¤§ç™½èœ","å°ç™½èœ", "ä¸Šæµ·é’",
        "èŒ„å­", "è¥¿çº¢æŸ¿", "èƒ¡èåœ", "è¥¿è“èŠ±", "ç´«ç”˜è“","ç¾½è¡£ç”˜è“","è·å…°è±†", "å››å­£è±†","å½©æ¤’","ç´«æ´‹è‘±", "è±†è…","çº³è±†", "ç‰›å¥¶", "é…¸å¥¶","å¥¶é…ª", 
        "é¸¡è›‹ï¼ˆä¸ªï¼‰", "è½¦å˜å­", "é»„å¿ƒå¥‡å¼‚æœ","åŒ—æç”œè™¾ä»", "ä¸‰æ–‡é±¼","ç›ç„—é¸¡","è’²çƒ§é³—é±¼","çŒªè‚", "å¤§å®¶ä¹é¸¡èƒ¸è‚‰é¥­ï¼ˆä»½ï¼‰","å¤§å®¶ä¹ä¸‰æ–‡é±¼é¥­ï¼ˆä»½ï¼‰"];
      foodData = {
        "æ ¸æ¡ƒä»": { protein: 13.8, fat:73.7, carbs: 1.3, magnesium: 117, calcium: 65 ,defaultGrams:5.7},
        "å—ç“œç±½": { protein: 29.4, fat:53.9,carbs: 10.8, magnesium: 321, calcium: 46 ,defaultGrams:5.4},
        "ç†Ÿäºšéº»ç±½": { protein: 24.9, fat:41.9,carbs: 3.7, magnesium: 392, calcium: 255 ,defaultGrams:5},
        "çº¯ç¢±çƒ¤é¦": { protein: 14.1, fat:1.4,carbs: 77.6, magnesium: 25, calcium: 15 ,defaultGrams:13},
        "æ™®é€šéº¦ç‰‡": { protein: 14,fat:8.1, carbs: 56.4, magnesium: 112, calcium: 17 ,defaultGrams:40},
        "äº”é»‘éº¦ç‰‡": { protein: 15,fat:5.5, carbs: 60.6, magnesium: 184, calcium: 35 ,defaultGrams:40},
        "åŒ…å­ï¼ˆä¸ªï¼‰": { protein: 5.2,fat:13.3, carbs: 31.4, magnesium: 16, calcium: 10.4 ,defaultGrams:100},
        "èŠ‹å¤´": { protein: 2.1,fat:0.2, carbs: 20.1, magnesium: 33, calcium: 43 },
        "ç”œç‰ç±³": { protein: 3.4,fat:1.2, carbs: 19, magnesium: 37, calcium: 2.2 },
        "ç™½ç±³è—œéº¦é¥­ï¼ˆä»½ï¼‰": { protein: 4, fat:1.2,carbs: 29.9, magnesium: 50.9, calcium: 11.7 ,defaultGrams:100},
        "è‹¦èéº¦é¢": { protein: 10, fat:1.2,carbs: 71.7, magnesium: 251, calcium: 21,defaultGrams:100 },
        "æ™®é€šé¢æ¡": { protein: 11.2,fat:2.2, carbs: 72, magnesium: 22, calcium: 18 },
        "åŒå‰ï¼ˆä»½ï¼‰": { protein: 27,fat:22, carbs: 32, magnesium: 22, calcium: 232 ,defaultGrams:100},
        "å•å‰ï¼ˆä»½ï¼‰": { protein: 17,fat:12, carbs: 31, magnesium: 20, calcium: 144 ,defaultGrams:100},
        "0å‰ï¼ˆæ±‰å ¡åŒ…ï¼‰ï¼ˆä»½ï¼‰": { protein: 14, fat:8,carbs: 29, magnesium: 18, calcium: 61,defaultGrams:100 },
        "éº¦é¦™é±¼ï¼ˆä»½ï¼‰": { protein: 16, fat:13,carbs: 37, magnesium: 25, calcium: 99 ,defaultGrams:100},
        "éº¦é¦™é¸¡ï¼ˆä»½ï¼‰": { protein: 16, fat:17,carbs: 41, magnesium: 22, calcium: 73 ,defaultGrams:100},
        "çŒªæŸ³éº¦æ»¡åˆ†ï¼ˆä»½ï¼‰": { protein: 16,fat:16, carbs: 25, magnesium: 20, calcium: 213,defaultGrams:100 },
        "çŒªæŸ³è›‹éº¦æ»¡åˆ†ï¼ˆä»½ï¼‰": { protein: 23,fat:21, carbs: 26, magnesium: 25, calcium: 243 ,defaultGrams:100},
        "è èœ": { protein: 2.6,fat:0.4, carbs: 2.9, magnesium: 65, calcium: 99 },
        "å¤§ç™½èœ": { protein: 1.5, fat:0.2,carbs: 3.4, magnesium: 12, calcium: 57 }, 
        "å°ç™½èœ": { protein: 1.5, fat:0.2,carbs: 1.8, magnesium: 13, calcium: 84 },          
        "ä¸Šæµ·é’": { protein: 1.3,fat:0.2, carbs: 1.7, magnesium: 12, calcium: 108 },
        "èŒ„å­": { protein: 1.1,fat:0.2, carbs: 5.4, magnesium: 13, calcium: 11 },
        "è¥¿çº¢æŸ¿": { protein: 0.9,fat:0.2, carbs: 3.9, magnesium: 9, calcium: 10 },
        "èƒ¡èåœ": { protein: 1.0,fat:0.2, carbs: 8.2, magnesium: 12, calcium: 32 },
        "è¥¿è“èŠ±": { protein: 2.8,fat:0, carbs: 4.9, magnesium: 21, calcium: 47 },
        "ç´«ç”˜è“": { protein: 1.9,fat:0, carbs: 6.4, magnesium: 11, calcium: 43 },
        "ç¾½è¡£ç”˜è“": { protein: 4.3,fat:0, carbs: 8.8, magnesium: 47, calcium: 254 }, 
        "å½©æ¤’": { protein: 0.9,fat:0.3, carbs: 6, magnesium: 12, calcium: 7 },
        "ç´«æ´‹è‘±": { protein: 1.1,fat:0.1, carbs: 9.3, magnesium: 10, calcium: 23 },           
        "è±†è…": { protein: 8.1, fat:0,carbs: 2.2, magnesium: 31, calcium: 164 },
        "çº³è±†": { protein: 15, fat:1,carbs: 19.4, magnesium: 100, calcium: 90,defaultGrams:50 },
        "ç‰›å¥¶": { protein: 3.4,fat:3.7, carbs: 4.8, magnesium: 11, calcium: 104 },
        "é…¸å¥¶": { protein: 4.2,fat:4.8, carbs: 5.6, magnesium: 17, calcium: 130 },
        "éº»é…±": { protein: 24.3,fat:57.8, carbs: 13.6, magnesium: 360, calcium: 1030 ,defaultGrams:22},
        "è·å…°è±†": { protein: 2.8, fat:0,carbs: 6.9, magnesium: 27, calcium: 30 },
        "å››å­£è±†": { protein: 2.4,fat:0, carbs: 5.8, magnesium: 33, calcium: 42 },
        "é¸¡è›‹ï¼ˆä¸ªï¼‰": { protein: 6.5,fat:4.85, carbs: 0.6, magnesium: 5.5, calcium: 28 },
        "è½¦å˜å­": { protein: 1.0,fat:0, carbs: 16, magnesium: 11, calcium: 13 ,defaultGrams:45},
        "é»„å¿ƒå¥‡å¼‚æœ": { protein: 1.2, fat:0,carbs: 14.5, magnesium: 17, calcium: 34,defaultGrams:110 },
        "åŒ—æç”œè™¾ä»": { protein: 15, fat:0.7,carbs: 0, magnesium: 51, calcium: 83 },
        "ä¸‰æ–‡é±¼": { protein: 20.5, fat:12.2,carbs: 0, magnesium: 35, calcium: 15 },
        "ç›ç„—é¸¡": { protein: 22, fat:13,carbs: 0, magnesium: 24, calcium: 11 },
        "è’²çƒ§é³—é±¼": { protein: 17.5, fat:25.4,carbs: 4.6, magnesium: 28, calcium: 13 },
        "çŒªè‚": { protein: 30.7, fat:2.7,carbs: 5, magnesium: 18, calcium: 8 },
        "å¥¶é…ª": { protein: 22,fat:25.3, carbs: 2.6, magnesium: 23, calcium: 691 ,defaultGrams:20},
        "å¤§å®¶ä¹é¸¡èƒ¸è‚‰é¥­ï¼ˆä»½ï¼‰": { protein: 50,fat:16,carbs: 86.7,magnesium: 70.9,calcium: 44.3,defaultGrams:100},
        "å¤§å®¶ä¹ä¸‰æ–‡é±¼é¥­ï¼ˆä»½ï¼‰": {protein: 45,fat:28.3,carbs: 86.7,magnesium: 82.8,calcium: 52.3,defaultGrams:100}
      };
      const customFoods = JSON.parse(localStorage.getItem("customFoods") || "{}");
      Object.keys(customFoods).forEach(name => {
        foodOptions.push(name);
        foodData[name] = customFoods[name];
      });
    }

    
    
    function renderFoodList() {
      const customContainer = document.getElementById("foodList");
      customContainer.innerHTML = "";

      const customFoods = JSON.parse(localStorage.getItem("customFoods") || "{}");
      const customTable = document.createElement("table");
      customTable.innerHTML = `
        <tr>
          <th>é£Ÿç‰©</th>
          <th>è›‹ç™½è´¨ (g)</th>
          <th>è„‚è‚ª (g)</th>
          <th>ç¢³æ°´ (g)</th>
          <th>é• (mg)</th>
          <th>é’™ (mg)</th>
          <th>æ“ä½œ</th>
        </tr>
      `;
      for (const name in customFoods) {
        const f = customFoods[name];
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${name}</td>
          <td>${f.protein}</td>
          <td>${f.fat}</td>
          <td>${f.carbs}</td>
          <td>${f.magnesium}</td>
          <td>${f.calcium}</td>
          <td>
            <button onclick="editFood('${name}')">âœï¸ç¼–è¾‘</button>
            <button onclick="deleteCustomFood('${name}')">åˆ é™¤</button>
          </td>
        `;
        customTable.appendChild(row);
      }
      customContainer.appendChild(customTable);

      const ref = document.getElementById("foodReference");
      ref.innerHTML = "";
      const defaultTable = document.createElement("table");
      defaultTable.innerHTML = `
        <tr>
          <th>é£Ÿç‰©</th>
          <th>è›‹ç™½è´¨ (g)</th>
          <th>è„‚è‚ª (g)</th>
          <th>ç¢³æ°´ (g)</th>
          <th>é• (mg)</th>
          <th>é’™ (mg)</th>
        </tr>
      `;
      for (const name of [
        "æ ¸æ¡ƒä»", "å—ç“œç±½", "ç†Ÿäºšéº»ç±½", "çº¯ç¢±çƒ¤é¦", "æ™®é€šéº¦ç‰‡", "äº”é»‘éº¦ç‰‡", "åŒ…å­ï¼ˆä¸ªï¼‰", "èŠ‹å¤´","ç”œç‰ç±³",
        "ç™½ç±³è—œéº¦é¥­ï¼ˆä»½ï¼‰", "è‹¦èéº¦é¢", "æ™®é€šé¢æ¡", "åŒå‰ï¼ˆä»½ï¼‰","å•å‰ï¼ˆä»½ï¼‰","0å‰ï¼ˆæ±‰å ¡åŒ…ï¼‰ï¼ˆä»½ï¼‰",
       "éº¦é¦™é¸¡ï¼ˆä»½ï¼‰","éº¦é¦™é±¼ï¼ˆä»½ï¼‰","çŒªæŸ³éº¦æ»¡åˆ†ï¼ˆä»½ï¼‰","çŒªæŸ³è›‹éº¦æ»¡åˆ†ï¼ˆä»½ï¼‰", "è èœ", "å¤§ç™½èœ","å°ç™½èœ", "ä¸Šæµ·é’",
        "èŒ„å­", "è¥¿çº¢æŸ¿", "èƒ¡èåœ", "è¥¿è“èŠ±", "ç´«ç”˜è“","ç¾½è¡£ç”˜è“","è·å…°è±†", "å››å­£è±†","å½©æ¤’","ç´«æ´‹è‘±", "è±†è…","çº³è±†", "ç‰›å¥¶", "é…¸å¥¶","å¥¶é…ª", 
        "é¸¡è›‹ï¼ˆä¸ªï¼‰", "è½¦å˜å­", "é»„å¿ƒå¥‡å¼‚æœ","åŒ—æç”œè™¾ä»", "ä¸‰æ–‡é±¼","ç›ç„—é¸¡","è’²çƒ§é³—é±¼","çŒªè‚", "å¤§å®¶ä¹é¸¡èƒ¸è‚‰é¥­ï¼ˆä»½ï¼‰","å¤§å®¶ä¹ä¸‰æ–‡é±¼é¥­ï¼ˆä»½ï¼‰"]) 
        {
        const f = foodData[name];
        if (!f) continue;
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${name}</td>
          <td>${f.protein}</td>
          <td>${f.fat}</td>
          <td>${f.carbs}</td>
          <td>${f.magnesium}</td>
          <td>${f.calcium}</td>
        `;
        defaultTable.appendChild(row);
      }
      ref.appendChild(defaultTable);
    }


    function addFood() {
      const name = document.getElementById("foodName").value.trim();
      const protein = parseFloat(document.getElementById("protein").value);
      const fat = parseFloat(document.getElementById("fat").value);
      const carbs = parseFloat(document.getElementById("carbs").value);
      const magnesium = parseFloat(document.getElementById("magnesium").value);
      const calcium = parseFloat(document.getElementById("calcium").value);

      if (!name || isNaN(protein) || isNaN(fat) || isNaN(carbs) || isNaN(magnesium) || isNaN(calcium)) {
        alert("è¯·å¡«å†™å®Œæ•´ä¿¡æ¯");
        return;
      }
      const foods = JSON.parse(localStorage.getItem("customFoods") || "{}");
      foods[name] = { protein, fat, carbs, magnesium, calcium };
      localStorage.setItem("customFoods", JSON.stringify(foods));
      renderFoodList();
      alert("æ·»åŠ æˆåŠŸï¼");
    }

    function showManager() {
      document.getElementById('main-page').classList.add('hidden');
      document.getElementById('manager-page').classList.remove('hidden');
      renderFoodList();
    }

    function showMain() {
      document.getElementById('manager-page').classList.add('hidden');
      document.getElementById('main-page').classList.remove('hidden');
      resetAll();
    }

    function createFoodEntry(mealId) {
      const container = document.createElement("div");

      const foodDiv = document.createElement("div");
      foodDiv.className = "food-entry";
      const label1 = document.createElement("label");
      label1.textContent = "é£Ÿç‰©:";
      const select = document.createElement("select");
      const placeholderOption = document.createElement("option");
      placeholderOption.textContent = "è¯·é€‰æ‹©";
      placeholderOption.disabled = true;
      placeholderOption.selected = true;
      select.appendChild(placeholderOption);
      foodOptions.forEach(opt => {
        const option = document.createElement("option");
        option.textContent = opt;
        select.appendChild(option);
      });

      const gramDiv = document.createElement("div");
      gramDiv.className = "food-entry";
      const label2 = document.createElement("label");
      label2.textContent = "å…‹æ•°:";
      const input = document.createElement("input");
      input.type = "number";
      input.placeholder = "å…‹æ•°ï¼ˆæŒ‰ä»½è®¡åˆ™è¾“å…¥100ï¼‰";

      select.onchange = () => {
        const selectedFood = select.value;
        if (foodData[selectedFood]?.defaultGrams && !input.value) {
          input.value = foodData[selectedFood].defaultGrams;
        }
        calculateMeal(mealId);
        calculateTotal();
      };

      input.oninput = () => {
        calculateMeal(mealId);
        calculateTotal();
      };

      foodDiv.appendChild(label1);
      foodDiv.appendChild(select);
      gramDiv.appendChild(label2);
      gramDiv.appendChild(input);
      container.appendChild(foodDiv);
      container.appendChild(gramDiv);
      const delBtn = document.createElement("button");
      delBtn.textContent = "åˆ é™¤";
      delBtn.className = "remove-button";   // è‹¥ä¸ç”¨æ ·å¼å¯åˆ è¿™ä¸€è¡Œ
      delBtn.onclick = () => {
        container.remove();          // æŠŠè¿™ä¸€æ•´è¡Œä» DOM ä¸­ç§»é™¤
        calculateMeal(mealId);       // é‡æ–°è®¡ç®—è¯¥é¤å°è®¡
        calculateTotal();            // é‡æ–°è®¡ç®—æ¯æ—¥æ€»è®¡
      };

        // æŠŠæ‰€æœ‰å…ƒç´ ç»„è£…è¿› container
      container.appendChild(foodDiv);
      container.appendChild(gramDiv);
      container.appendChild(delBtn);   // â­ æŠŠæŒ‰é’®æ”¾è¿›å»

      return container;
    }

    function addFoodEntry(mealId) {
      const section = document.querySelector(`#${mealId} .food-list`);
      const entry = createFoodEntry(mealId);
      section.appendChild(entry);
    }

    function calculateMeal(mealId) {
      const entries = document.querySelectorAll(`#${mealId} .food-list > div`);
      let total = { protein: 0,fat: 0, carbs: 0, magnesium: 0, calcium: 0 };

      entries.forEach(container => {
        const selects = container.querySelectorAll("select");
        const inputs = container.querySelectorAll("input");

        if (selects.length && inputs.length) {
          const food = selects[0].value;
          const grams = parseFloat(inputs[0].value);
          if (foodData[food] && !isNaN(grams)) {
            const ratio = grams / 100;
            total.protein += foodData[food].protein * ratio;
            total.fat += foodData[food].fat * ratio;
            total.carbs += foodData[food].carbs * ratio;
            total.magnesium += foodData[food].magnesium * ratio;
            total.calcium += foodData[food].calcium * ratio;
          }
        }
      });

      const totalDiv = document.querySelector(`#${mealId}-total`);
      totalDiv.innerHTML = `è›‹ç™½è´¨ï¼š${total.protein.toFixed(1)} g<br/>è„‚è‚ªï¼š${total.fat.toFixed(1)} g<br/>ç¢³æ°´ï¼š${total.carbs.toFixed(1)} g<br/>é•ï¼š${total.magnesium.toFixed(1)} mg<br/>é’™ï¼š${total.calcium.toFixed(1)} mg`;
    }

    function calculateTotal() {
      const meals = ['breakfast', 'lunch', 'dinner'];
      let grandTotal = { protein: 0, fat: 0, carbs: 0, magnesium: 0, calcium: 0 };
      meals.forEach(meal => {
        const entries = document.querySelectorAll(`#${meal} .food-list > div`);
        entries.forEach(container => {
          const selects = container.querySelectorAll("select");
          const inputs = container.querySelectorAll("input");
          if (selects.length && inputs.length) {
            const food = selects[0].value;
            const grams = parseFloat(inputs[0].value);
            if (foodData[food] && !isNaN(grams)) {
              const ratio = grams / 100;
              grandTotal.protein += foodData[food].protein * ratio;
              grandTotal.fat += foodData[food].fat * ratio;
              grandTotal.carbs += foodData[food].carbs * ratio;
              grandTotal.magnesium += foodData[food].magnesium * ratio;
              grandTotal.calcium += foodData[food].calcium * ratio;
            }
          }
        });
      });
      const totalDiv = document.querySelector("#daily-total");
      totalDiv.innerHTML = `è›‹ç™½è´¨ï¼š${grandTotal.protein.toFixed(1)} g<br/>è„‚è‚ªï¼š${grandTotal.fat.toFixed(1)} g<br/>ç¢³æ°´ï¼š${grandTotal.carbs.toFixed(1)} g<br/>é•ï¼š${grandTotal.magnesium.toFixed(1)} mg<br/>é’™ï¼š${grandTotal.calcium.toFixed(1)} mg`;
    }

    function resetAll() {
      document.querySelectorAll('.food-list').forEach(section => section.innerHTML = "");
      loadFoodsFromStorage();
      addFoodEntry('breakfast');
      addFoodEntry('lunch');
      addFoodEntry('dinner');
    }

    function editFood(name) {
      const foods = JSON.parse(localStorage.getItem("customFoods") || "{}");
      const f = foods[name];

      const newProtein = prompt(`ä¿®æ”¹ã€${name}ã€‘çš„è›‹ç™½è´¨ï¼ˆg/100gï¼‰ï¼š`, f.protein);
      const newFat = prompt(`ä¿®æ”¹ã€${name}ã€‘çš„è„‚è‚ªï¼ˆg/100gï¼‰ï¼š`, f.fat);
      const newCarbs = prompt(`ä¿®æ”¹ã€${name}ã€‘çš„ç¢³æ°´ï¼ˆg/100gï¼‰ï¼š`, f.carbs);
      const newMag = prompt(`ä¿®æ”¹ã€${name}ã€‘çš„é•ï¼ˆmg/100gï¼‰ï¼š`, f.magnesium);
      const newCal = prompt(`ä¿®æ”¹ã€${name}ã€‘çš„é’™ï¼ˆmg/100gï¼‰ï¼š`, f.calcium);

      if (
        newProtein !== null &&
        newCarbs !== null &&
        newMag !== null &&
        newCal !== null
      ) {
        foods[name] = {
          protein: parseFloat(newProtein),
          fat: parseFloat(newFat),
          carbs: parseFloat(newCarbs),
          magnesium: parseFloat(newMag),
          calcium: parseFloat(newCal)
        };
        localStorage.setItem("customFoods", JSON.stringify(foods));
        renderFoodList();
        alert("ä¿®æ”¹æˆåŠŸï¼");
      }
      }
    function deleteCustomFood(name) {
      if (confirm(`ç¡®å®šè¦åˆ é™¤ ${name} å—ï¼Ÿ`)) {
        const foods = JSON.parse(localStorage.getItem("customFoods") || "{}");
        delete foods[name];
        localStorage.setItem("customFoods", JSON.stringify(foods));
        renderFoodList();
        alert(`${name} å·²åˆ é™¤`);
      }
    }

    function resetDailyIntake() {
      /* 1. æ¸…ç©ºä¸‰é¤åŒºåŸŸé‡Œçš„æ‰€æœ‰å·²æ·»åŠ æ¡ç›® */
      document.querySelectorAll(".food-list").forEach(sec => (sec.innerHTML = ""));

      /* 2. æŠŠæ¯é¤çš„å°è®¡æ–‡å­—æ¢å¤æˆåˆå§‹æç¤º */
      document.getElementById("breakfast-total").innerHTML = "è¥å…»æˆåˆ†: ç­‰å¾…è¾“å…¥ä¸­...";
      document.getElementById("lunch-total").innerHTML     = "è¥å…»æˆåˆ†: ç­‰å¾…è¾“å…¥ä¸­...";
      document.getElementById("dinner-total").innerHTML    = "è¥å…»æˆåˆ†: ç­‰å¾…è¾“å…¥ä¸­...";

      /* 3. æ¸…ç©ºâ€œæ¯æ—¥æ‘„å…¥è®°å½•â€åˆ—è¡¨ï¼ˆå¦‚æœä½ è¿˜åœ¨ç”¨å®ƒï¼‰ */
      document.getElementById("intakeTable").innerHTML = "";

      /* 4. é‡ç½®åº•éƒ¨æ€»è®¡ */
      document.getElementById("daily-total").innerHTML = `
        è›‹ç™½è´¨ï¼š-- g<br />
        è„‚è‚ªï¼š-- g<br />
        ç¢³æ°´ï¼š-- g<br />
        é•ï¼š-- mg<br />
        é’™ï¼š-- mg<br />
      `;

      /* 5. å¦‚æœæƒ³è‡ªåŠ¨å†æ”¾å›ä¸‰æ¡ç©ºç™½è¾“å…¥ï¼Œå¯è°ƒç”¨ä½ å·²æœ‰çš„ resetAll() */
      resetAll();      // â† å¦‚æœéœ€è¦ï¼Œå–æ¶ˆè¿™è¡Œæ³¨é‡Š
    }

    loadFoodsFromStorage();
    resetAll();
  </script>
</body>
</html>