<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è¥å…»è®¡ç®—å™¨</title>
  <style>
    * {
      box-sizing: border-box;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      font-size: 14px;
    }

    th {
      background-color: #f7f7f7;
    }
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 10px;
      background-color: #fdfcfb;
    }
    h1 {
      color: #333;
    }
    .link-button {
      margin-top: 5px;
      display: inline-block;
      padding: 6px 12px;
      background-color: #ffddaa;
      color: #333;
      text-decoration: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .hidden {
      display: none;
    }
    h2 {
      color: #333;
      margin-top: 20px;
    }
    .meal-section {
      background-color: #fff;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .food-entry {
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
    }
    label {
      font-weight: bold;
      margin-bottom: 5px;
    }
    select, input {
      padding: 8px;
      margin-bottom: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .totals {
      margin-top: 15px;
      font-weight: bold;
      color: #444;
    }
    .add-food {
      margin-top: 10px;
      padding: 6px 12px;
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 5px;
      cursor: pointer;
    }
    ul {
      margin-top: 10px;
      padding-left: 20px;
    }
    ul li {
      margin-bottom: 5px;
    }
    @media (min-width: 600px) {
      .food-entry {
        flex-direction: row;
        align-items: center;
        gap: 10px;
      }
      label {
        width: 80px;
        margin-bottom: 0;
      }
    }
  </style>
</head>
<body>

  <div id="main-page">
    <h1>å–µå–µçš„è¥å…»è®°å½•å™¨ğŸ±</h1>
    <button class="link-button" onclick="showManager()">ğŸ”§ ç®¡ç†é£Ÿç‰©é€‰é¡¹</button>

    <div class="meal-section" id="breakfast">
      <h2>ğŸ æ—©é¤</h2>
      <div class="food-list"></div>
      <button class="add-food" onclick="addFoodEntry('breakfast')">â• æ·»åŠ é£Ÿç‰©</button>
      <div class="totals" id="breakfast-total">è¥å…»æˆåˆ†: ç­‰å¾…è¾“å…¥ä¸­...</div>
    </div>

    <div class="meal-section" id="lunch">
      <h2>ğŸ± åˆé¤</h2>
      <div class="food-list"></div>
      <button class="add-food" onclick="addFoodEntry('lunch')">â• æ·»åŠ é£Ÿç‰©</button>
      <div class="totals" id="lunch-total">è¥å…»æˆåˆ†: ç­‰å¾…è¾“å…¥ä¸­...</div>
    </div>

    <div class="meal-section" id="dinner">
      <h2>ğŸ” æ™šé¤</h2>
      <div class="food-list"></div>
      <button class="add-food" onclick="addFoodEntry('dinner')">â• æ·»åŠ é£Ÿç‰©</button>
      <div class="totals" id="dinner-total">è¥å…»æˆåˆ†: ç­‰å¾…è¾“å…¥ä¸­...</div>
    </div>

    <h2>ğŸ“Š æ¯æ—¥æ€»è®¡</h2>
    <div class="meal-section">
      <div class="totals" id="daily-total">
        è›‹ç™½è´¨ï¼š-- g<br />
        ç¢³æ°´ï¼š-- g<br />
        é•ï¼š-- mg<br />
        é’™ï¼š-- mg<br />
      </div>
    </div>
  </div>

  <div id="manager-page" class="hidden">
    <h1>ğŸ½ï¸ é£Ÿç‰©ç®¡ç†</h1>
    <button class="link-button" onclick="showMain()">â¬…ï¸ è¿”å›</button>

    <label for="foodName">é£Ÿç‰©åç§°ï¼š</label>
    <input type="text" id="foodName" placeholder="ä¾‹å¦‚ï¼šé¸¡è›‹">

    <label for="protein">è›‹ç™½è´¨ï¼ˆg/100gï¼‰ï¼š</label>
    <input type="number" id="protein">

    <label for="carbs">ç¢³æ°´ï¼ˆg/100gï¼‰ï¼š</label>
    <input type="number" id="carbs">

    <label for="magnesium">é•ï¼ˆmg/100gï¼‰ï¼š</label>
    <input type="number" id="magnesium">

    <label for="calcium">é’™ï¼ˆmg/100gï¼‰ï¼š</label>
    <input type="number" id="calcium">

    <button onclick="addFood()">â• æ·»åŠ é£Ÿç‰©</button>

    <h2>ğŸ“‹ å½“å‰é»˜è®¤é£Ÿç‰©æ•°æ®åº“ï¼š</h2>
    <ul id="foodReference"></ul>

    <h2>ğŸ“ ä½ æ·»åŠ çš„è‡ªå®šä¹‰é£Ÿç‰©ï¼š</h2>
    <ul id="foodList"></ul>
  </div>

  <script>
    let foodOptions = [];
    let foodData = {};

    function loadFoodsFromStorage() {
      foodOptions = ["æ ¸æ¡ƒä»", "å—ç“œç±½", "ç†Ÿäºšéº»ç±½", "çº¯ç¢±çƒ¤é¦", "æ™®é€šéº¦ç‰‡", "äº”é»‘éº¦ç‰‡", 
      "åŒ…å­", "èŠ‹å¤´","ç™½ç±³è—œéº¦é¥­", "è‹¦èéº¦é¢", "æ™®é€šé¢æ¡", "åŒå‰","è èœ", "å°ç™½èœ", 
      "ä¸Šæµ·é’", "èŒ„å­", "è¥¿çº¢æŸ¿", "èƒ¡èåœ", "è¥¿è“èŠ±", "ç´«ç”˜è“","è±†è…", "ç‰›å¥¶", 
      "é…¸å¥¶", "è·å…°è±†", "å››å­£è±†","å¤§ç™½èœ", "é¸¡è›‹", "è½¦å˜å­", "é»„å¿ƒå¥‡å¼‚æœ","è™¾ä»", 
      "ä¸‰æ–‡é±¼", "å¥¶é…ª","å¤§å®¶ä¹é¸¡èƒ¸è‚‰é¥­", "å¤§å®¶ä¹ä¸‰æ–‡é±¼é¥­"];
      foodData = {
        "æ ¸æ¡ƒä»": { protein: 15, carbs: 13.7, magnesium: 158, calcium: 98 },
        "å—ç“œç±½": { protein: 33, carbs: 10.7, magnesium: 535, calcium: 46 },
        "ç†Ÿäºšéº»ç±½": { protein: 18.3, carbs: 28.9, magnesium: 392, calcium: 255 },
        "çº¯ç¢±çƒ¤é¦": { protein: 9.5, carbs: 57, magnesium: 25, calcium: 15 },
        "æ™®é€šéº¦ç‰‡": { protein: 10.2, carbs: 65, magnesium: 40, calcium: 17 },
        "äº”é»‘éº¦ç‰‡": { protein: 12, carbs: 60, magnesium: 80, calcium: 35 },
        "åŒ…å­": { protein: 6.3, carbs: 39.6, magnesium: 20, calcium: 13 },
        "èŠ‹å¤´": { protein: 2.1, carbs: 20.1, magnesium: 33, calcium: 43 },
        "ç™½ç±³è—œéº¦é¥­": { protein: 3.4, carbs: 26.7, magnesium: 30, calcium: 8 },
        "è‹¦èéº¦é¢": { protein: 11.2, carbs: 71.5, magnesium: 251, calcium: 21 },
        "æ™®é€šé¢æ¡": { protein: 8.6, carbs: 71.5, magnesium: 22, calcium: 18 },
        "åŒå‰": { protein: 17.8, carbs: 31.3, magnesium: 22, calcium: 159 },
        "è èœ": { protein: 2.6, carbs: 2.9, magnesium: 65, calcium: 99 },
        "å°ç™½èœ": { protein: 1.5, carbs: 1.8, magnesium: 13, calcium: 84 },          
        "ä¸Šæµ·é’": { protein: 1.3, carbs: 1.7, magnesium: 12, calcium: 108 },
        "èŒ„å­": { protein: 1.1, carbs: 5.4, magnesium: 13, calcium: 11 },
        "è¥¿çº¢æŸ¿": { protein: 0.9, carbs: 3.9, magnesium: 9, calcium: 10 },
        "èƒ¡èåœ": { protein: 1.0, carbs: 8.2, magnesium: 12, calcium: 32 },
        "è¥¿è“èŠ±": { protein: 2.8, carbs: 4.9, magnesium: 21, calcium: 47 },
        "ç´«ç”˜è“": { protein: 1.9, carbs: 6.4, magnesium: 11, calcium: 43 },          
        "è±†è…": { protein: 8.1, carbs: 2.2, magnesium: 31, calcium: 164 },
        "ç‰›å¥¶": { protein: 3.4, carbs: 4.8, magnesium: 11, calcium: 104 },
        "é…¸å¥¶": { protein: 3.0, carbs: 6.6, magnesium: 17, calcium: 120 },
        "è·å…°è±†": { protein: 2.8, carbs: 6.9, magnesium: 27, calcium: 30 },
        "å››å­£è±†": { protein: 2.4, carbs: 5.8, magnesium: 33, calcium: 42 },
        "é¸¡è›‹": { protein: 13.3, carbs: 1.3, magnesium: 10, calcium: 56 },
        "è½¦å˜å­": { protein: 1.0, carbs: 16, magnesium: 11, calcium: 13 },
        "é»„å¿ƒå¥‡å¼‚æœ": { protein: 1.2, carbs: 14.5, magnesium: 17, calcium: 34 },
        "è™¾ä»": { protein: 20, carbs: 1.5, magnesium: 30, calcium: 70 },
        "ä¸‰æ–‡é±¼": { protein: 20.8, carbs: 0, magnesium: 35, calcium: 15 },
        "å¥¶é…ª": { protein: 25, carbs: 3, magnesium: 23, calcium: 700 },
        "å¤§å®¶ä¹é¸¡èƒ¸è‚‰é¥­": { protein: 50,carbs: 40.6,magnesium: 70.9,calcium: 44.3},
        "å¤§å®¶ä¹ä¸‰æ–‡é±¼é¥­": {protein: 45,carbs: 40.6,magnesium: 82.8,calcium: 52.3}
      };
      const customFoods = JSON.parse(localStorage.getItem("customFoods") || "{}");
      Object.keys(customFoods).forEach(name => {
        foodOptions.push(name);
        foodData[name] = customFoods[name];
      });
    }

    
    
    function renderFoodList() {
      const customContainer = document.getElementById("foodList");
      customContainer.innerHTML = "";

      const customFoods = JSON.parse(localStorage.getItem("customFoods") || "{}");
      const customTable = document.createElement("table");
      customTable.innerHTML = `
        <tr>
          <th>é£Ÿç‰©</th>
          <th>è›‹ç™½è´¨ (g)</th>
          <th>ç¢³æ°´ (g)</th>
          <th>é• (mg)</th>
          <th>é’™ (mg)</th>
        </tr>
      `;
      for (const name in customFoods) {
        const f = customFoods[name];
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${name}</td>
          <td>${f.protein}</td>
          <td>${f.carbs}</td>
          <td>${f.magnesium}</td>
          <td>${f.calcium}</td>
        `;
        customTable.appendChild(row);
      }
      customContainer.appendChild(customTable);

      const ref = document.getElementById("foodReference");
      ref.innerHTML = "";
      const defaultTable = document.createElement("table");
      defaultTable.innerHTML = `
        <tr>
          <th>é£Ÿç‰©</th>
          <th>è›‹ç™½è´¨ (g)</th>
          <th>ç¢³æ°´ (g)</th>
          <th>é• (mg)</th>
          <th>é’™ (mg)</th>
        </tr>
      `;
      for (const name of [
        "æ ¸æ¡ƒä»", "å—ç“œç±½", "ç†Ÿäºšéº»ç±½", "çº¯ç¢±çƒ¤é¦", "æ™®é€šéº¦ç‰‡", "äº”é»‘éº¦ç‰‡", "åŒ…å­", "èŠ‹å¤´",
        "ç™½ç±³è—œéº¦é¥­", "è‹¦èéº¦é¢", "æ™®é€šé¢æ¡", "åŒå‰", "è èœ", "å°ç™½èœ", "ä¸Šæµ·é’",
        "èŒ„å­", "è¥¿çº¢æŸ¿", "èƒ¡èåœ", "è¥¿è“èŠ±", "ç´«ç”˜è“", "è±†è…", "ç‰›å¥¶", "é…¸å¥¶", "è·å…°è±†", "å››å­£è±†",
        "å¤§ç™½èœ", "é¸¡è›‹", "è½¦å˜å­", "é»„å¿ƒå¥‡å¼‚æœ","è™¾ä»", "ä¸‰æ–‡é±¼", "å¥¶é…ª","å¤§å®¶ä¹é¸¡èƒ¸è‚‰é¥­", "å¤§å®¶ä¹ä¸‰æ–‡é±¼é¥­"
      ]) {
        const f = foodData[name];
        if (!f) continue;
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${name}</td>
          <td>${f.protein}</td>
          <td>${f.carbs}</td>
          <td>${f.magnesium}</td>
          <td>${f.calcium}</td>
        `;
        defaultTable.appendChild(row);
      }
      ref.appendChild(defaultTable);
    }


    function addFood() {
      const name = document.getElementById("foodName").value.trim();
      const protein = parseFloat(document.getElementById("protein").value);
      const carbs = parseFloat(document.getElementById("carbs").value);
      const magnesium = parseFloat(document.getElementById("magnesium").value);
      const calcium = parseFloat(document.getElementById("calcium").value);

      if (!name || isNaN(protein) || isNaN(carbs) || isNaN(magnesium) || isNaN(calcium)) {
        alert("è¯·å¡«å†™å®Œæ•´ä¿¡æ¯");
        return;
      }
      const foods = JSON.parse(localStorage.getItem("customFoods") || "{}");
      foods[name] = { protein, carbs, magnesium, calcium };
      localStorage.setItem("customFoods", JSON.stringify(foods));
      renderFoodList();
      alert("æ·»åŠ æˆåŠŸï¼");
    }

    function showManager() {
      document.getElementById('main-page').classList.add('hidden');
      document.getElementById('manager-page').classList.remove('hidden');
      renderFoodList();
    }

    function showMain() {
      document.getElementById('manager-page').classList.add('hidden');
      document.getElementById('main-page').classList.remove('hidden');
      resetAll();
    }

    function createFoodEntry(mealId) {
      const container = document.createElement("div");

      const foodDiv = document.createElement("div");
      foodDiv.className = "food-entry";
      const label1 = document.createElement("label");
      label1.textContent = "é£Ÿç‰©:";
      const select = document.createElement("select");
      foodOptions.forEach(opt => {
        const option = document.createElement("option");
        option.textContent = opt;
        select.appendChild(option);
      });

      const gramDiv = document.createElement("div");
      gramDiv.className = "food-entry";
      const label2 = document.createElement("label");
      label2.textContent = "å…‹æ•°:";
      const input = document.createElement("input");
      input.type = "number";
      input.placeholder = "è¯·è¾“å…¥å…‹æ•°";

      select.onchange = input.oninput = () => {
        calculateMeal(mealId);
        calculateTotal();
      };

      foodDiv.appendChild(label1);
      foodDiv.appendChild(select);
      gramDiv.appendChild(label2);
      gramDiv.appendChild(input);
      container.appendChild(foodDiv);
      container.appendChild(gramDiv);
      return container;
    }

    function addFoodEntry(mealId) {
      const section = document.querySelector(`#${mealId} .food-list`);
      const entry = createFoodEntry(mealId);
      section.appendChild(entry);
    }

    function calculateMeal(mealId) {
      const entries = document.querySelectorAll(`#${mealId} .food-list > div`);
      let total = { protein: 0, carbs: 0, magnesium: 0, calcium: 0 };

      entries.forEach(container => {
        const selects = container.querySelectorAll("select");
        const inputs = container.querySelectorAll("input");

        if (selects.length && inputs.length) {
          const food = selects[0].value;
          const grams = parseFloat(inputs[0].value);
          if (foodData[food] && !isNaN(grams)) {
            const ratio = grams / 100;
            total.protein += foodData[food].protein * ratio;
            total.carbs += foodData[food].carbs * ratio;
            total.magnesium += foodData[food].magnesium * ratio;
            total.calcium += foodData[food].calcium * ratio;
          }
        }
      });

      const totalDiv = document.querySelector(`#${mealId}-total`);
      totalDiv.innerHTML = `è›‹ç™½è´¨ï¼š${total.protein.toFixed(1)} g<br/>ç¢³æ°´ï¼š${total.carbs.toFixed(1)} g<br/>é•ï¼š${total.magnesium.toFixed(1)} mg<br/>é’™ï¼š${total.calcium.toFixed(1)} mg`;
    }

    function calculateTotal() {
      const meals = ['breakfast', 'lunch', 'dinner'];
      let grandTotal = { protein: 0, carbs: 0, magnesium: 0, calcium: 0 };
      meals.forEach(meal => {
        const entries = document.querySelectorAll(`#${meal} .food-list > div`);
        entries.forEach(container => {
          const selects = container.querySelectorAll("select");
          const inputs = container.querySelectorAll("input");
          if (selects.length && inputs.length) {
            const food = selects[0].value;
            const grams = parseFloat(inputs[0].value);
            if (foodData[food] && !isNaN(grams)) {
              const ratio = grams / 100;
              grandTotal.protein += foodData[food].protein * ratio;
              grandTotal.carbs += foodData[food].carbs * ratio;
              grandTotal.magnesium += foodData[food].magnesium * ratio;
              grandTotal.calcium += foodData[food].calcium * ratio;
            }
          }
        });
      });
      const totalDiv = document.querySelector("#daily-total");
      totalDiv.innerHTML = `è›‹ç™½è´¨ï¼š${grandTotal.protein.toFixed(1)} g<br/>ç¢³æ°´ï¼š${grandTotal.carbs.toFixed(1)} g<br/>é•ï¼š${grandTotal.magnesium.toFixed(1)} mg<br/>é’™ï¼š${grandTotal.calcium.toFixed(1)} mg`;
    }

    function resetAll() {
      document.querySelectorAll('.food-list').forEach(section => section.innerHTML = "");
      loadFoodsFromStorage();
      addFoodEntry('breakfast');
      addFoodEntry('lunch');
      addFoodEntry('dinner');
    }

    loadFoodsFromStorage();
    resetAll();
  </script>
</body>
</html>